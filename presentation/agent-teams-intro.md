# Agent Teams — AI 코딩 어시스턴트의 팀워크

> 화요일 개발자 모임 발표 자료 (30분)

---

## 1. 문제 제기 (2분)

### AI 코딩 어시스턴트, 혼자 일하면 어디까지?

```
개발자 → Claude Code → 결과
```

단일 AI 에이전트의 한계:
- **한 번에 한 관점**: 코드 리뷰 시 보안/성능/아키텍처를 순차적으로 체크
- **Context Window 압박**: 큰 작업일수록 맥락이 흐려짐
- **앵커링 효과**: 첫 번째 가설에 고착되어 다른 가능성을 놓침

### Subagent는?

```
메인 Agent → Subagent 1 → 결과 반환
           → Subagent 2 → 결과 반환
           → Subagent 3 → 결과 반환
```

Subagent(Task tool)로 병렬화할 수 있지만:
- **단방향**: 결과만 반환, Subagent끼리 대화 불가
- **조율 불가**: 작업 중 동적 재배치 불가능
- **컨텍스트 오염**: 결과가 메인 세션에 합류

> "여러 명이 동시에 일하되, 서로 소통하고, 자율적으로 조율하면 어떨까?"

---

## 2. Agent Teams 소개 (5분)

### 핵심 아키텍처

```
┌─────────────────────────────────────────────┐
│                Team Lead                     │
│         (메인 Claude Code 세션)               │
│                                              │
│    ┌──────────┐  ┌──────────┐               │
│    │ Teammate │←→│ Teammate │  ← Mailbox    │
│    │    A     │  │    B     │    (양방향)     │
│    └────┬─────┘  └────┬─────┘               │
│         │              │                     │
│    ┌────┴──────────────┴─────┐              │
│    │      Shared Task List    │              │
│    │  pending → in_progress   │              │
│    │      → completed         │              │
│    └──────────────────────────┘              │
└─────────────────────────────────────────────┘
```

### 4가지 핵심 구성요소

| 구성요소 | 역할 |
|---------|------|
| **Team Lead** | 팀 생성, 작업 배분, 결과 종합 |
| **Teammates** | 독립 context window에서 자율 작업 |
| **Task List** | 공유 상태 관리 (blocked/blockedBy 의존성) |
| **Mailbox** | 양방향 메시징 (DM, broadcast, shutdown) |

### Subagents vs Agent Teams

| 측면 | Subagents | Agent Teams |
|------|-----------|-------------|
| 통신 | 결과만 반환 (단방향) | 양방향 DM + broadcast |
| 조율 | 메인이 순차 제어 | 공유 Task List, 자율 선택 |
| 병렬성 | 병렬 호출 가능 | 독립 프로세스 병렬 |
| 컨텍스트 | 결과가 메인에 합류 | **완전 격리** |
| 비용 | ~1.5x | ~4x (3명 팀) |

---

## 3. 실험 결과 (10분)

### 실험 1: 리서치 팀 — "Agent Teams vs Subagents"

**팀 구성**: Researcher 2 + Devil's Advocate 1

```
researcher-1 (Agent Teams 분석) ──┐
                                   ├──→ devils-advocate (비판적 검토)
researcher-2 (Subagents 비교)   ──┘
```

**결과**:
- 2명이 병렬로 문서 분석 → 순차 대비 ~50% 시간 단축
- Devil's Advocate의 핵심 지적:
  - **"일상 작업의 80-90%는 Subagent로 충분하다"**
  - Teams 고유 가치는 teammate 간 실시간 협업이 필요한 10-20%
  - 비용 배수(4x, 6x)는 추정치이며 실측 데이터 없음

**솔직한 평가**: 이 리서치는 Subagent 3개 병렬로도 유사한 결과 달성 가능.
다만 devil's advocate가 다른 researcher의 결과를 읽고 반박하는 과정은 Teams가 더 자연스러웠음.

---

### 실험 2: 코드 리뷰 팀 — PR #7402

**대상**: kidsnote_ios "[PK-33175] 임시저장 복원 시 원아/반 선택 정보 유지"
**팀 구성**: 3관점 병렬 리뷰

| 리뷰어 | 관점 | 결과 |
|--------|------|------|
| **logic-reviewer** | 로직/엣지케이스 | W4, I3 |
| **safety-reviewer** | 크래시/스레드/Obj-C | W2, I5 |
| **arch-reviewer** | ReactorKit 패턴/컨벤션 | W3, I5 |

**종합**: Critical 0건, Warning 9건, Info 13건 → **APPROVE (조건부)**

**교차 발견** (다관점 리뷰의 가치):
- 3명 중 2명이 독립적으로 "fallback 전략 비대칭" 지적
- 3명 중 2명이 독립적으로 "UserInfo.shared() 중복 호출" 지적
- 여러 관점에서 동일 이슈 발견 → 중요도가 자연스럽게 부각

**솔직한 평가**: 리뷰어 간 DM 미사용 → Subagent 3개 병렬로도 동일 결과 가능.
Teams의 차별점은 "logic-reviewer 발견 → safety-reviewer에게 교차 검증 DM" 같은 2단계 워크플로우에서 나타남.

---

## 4. 언제 사용하고, 언제 안 사용하나 (5분)

### 현실적 판단 기준

```
일상 작업의 80-90%          │  복잡한 작업 10-20%
─────────────────────────────┼──────────────────────
단일 세션 or Subagent로 충분  │  Teams 고려
                             │
• 단일 파일 버그 수정          │  • Cross-layer 기능 개발
• 기능 추가 (1-3 파일)        │  • 경쟁 가설 디버깅
• 코드 리뷰 (결과만 필요)      │  • 팀원 간 논의/반박 필요
• 라이브러리 리서치             │  • 파일 소유권 분리 가능한 병렬 개발
```

### Teams를 쓰지 말아야 할 때

- 순차적 의존 작업 (A→B→C→D)
- 동일 파일을 여러 agent가 수정 (last-write-wins, 자동 해결 안 됨)
- 단순/반복 작업 (조율 오버헤드 > 이득)
- 비용이 주요 관심사 (4-6배 비용 증가)

### 비용 vs 가치

| 구성 | 비용 배수 | 적합한 상황 |
|------|----------|------------|
| 단일 세션 | 1x | 대부분의 일상 작업 |
| Subagent | ~1.5x | 결과만 필요한 병렬 작업 |
| Teams 3명 | ~4x | 협업/논의가 필요한 복잡한 작업 |

> **핵심**: "Teams가 만능이 아니다"를 인정하는 것이 도입 판단의 시작점

---

## 5. 시작하는 방법 (3분)

### 3단계 설정

```bash
# 1. 환경변수 활성화 (settings.json의 env에 추가)
"CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS": "1"

# 2. Claude Code 실행
claude

# 3. 팀 생성 요청
"리서치 팀을 만들어줘. researcher 2명과 devil's advocate 1명으로 구성해줘."
```

### 첫 실험 추천 (안전한 시작)

1. **리서치 팀부터**: 코드 수정 없는 read-only 작업 → 충돌 위험 없음
2. **2-3명으로 시작**: 비용 통제, 조율 복잡도 최소화
3. **짧은 작업**: 10-15분 이내 완료 가능한 주제
4. **비활성화 쉬움**: 환경변수 1줄 삭제로 완전 복원

### 제한사항 (알고 시작하기)

- 실험적 기능 (세션 재개 불가)
- 한 세션에 한 팀만
- 파일 충돌 자동 해결 안 됨
- Split-pane: VS Code Terminal, Windows Terminal 미지원

---

## 6. Q&A (5분)

### 예상 질문

**Q: Subagent 병렬이면 충분하지 않나요?**
> 대부분 충분합니다. Teams의 고유 가치는 "결과가 아니라 과정에서의 협업"이 필요할 때 나타납니다.

**Q: 비용이 4배인데 시간이 4배 줄어드나요?**
> 아닙니다. 조율 오버헤드를 감안하면 2-3배 단축이 현실적이며, 병렬화 가능한 작업에만 해당됩니다.

**Q: 실험적 기능인데 프로덕션에 써도 되나요?**
> 리서치/리뷰처럼 코드 변경 없는 작업부터 시작하세요. 환경변수 1줄로 비활성화할 수 있어 위험이 낮습니다.

**Q: 파일 충돌은 어떻게?**
> 자동 해결 안 됩니다 (last-write-wins). 파일 소유권을 사전에 나눠야 합니다.

---

## 참고 자료

- GitHub: https://github.com/Allen-han21/claude-agent-teams
- 실험 보고서: `experiments/001-research-team.md`, `experiments/002-review-team.md`
- 공식 문서: Claude Code Agent Teams (실험적 기능)

---

> "Agent Teams는 만능이 아니다. 일상 작업의 80-90%는 Subagent로 충분하다.
> 하지만 teammate 간 실시간 협업이 필요한 10-20%의 복잡한 시나리오에서
> Teams는 Subagent로는 불가능한 가치를 제공한다."
